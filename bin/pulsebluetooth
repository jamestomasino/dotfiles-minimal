#!/bin/sh

scarlet="alsa_input.usb-Focusrite_Scarlett_2i2_USB-00.analog-stereo"
pcisink="alsa_output.pci-0000_0b_00.4.analog-stereo"
bluesink="bluez_sink.AC_80_0A_14_01_9F.a2dp_sink"

if [ "pci" = "$1" ]; then
  mastersink=$picsink
else
  mastersink=$bluesink
fi

# Cleanup
pacmd unload-module module-echo-cancel
pacmd unload-module module-remap-source

# Remap mono mic to stereo
pacmd load-module module-remap-source master=${scarlet} master_channel_map=front-left,front-left channel_map=front-left,front-right

# Echo Cancel (fixes volume too)
pacmd load-module module-echo-cancel source_master=${scarlet}.remapped sink_master=${mastersink}

# Set default devices
pacmd set-default-source ${scarlet}.remapped.echo-cancel
pacmd set-default-sink ${mastersink}

# Set default volume (needs a brief delay)
sleep 1
pactl set-sink-volume @DEFAULT_SINK@ 60%
pactl set-source-volume "${scarlet}.remapped.echo-cancel" 90%
